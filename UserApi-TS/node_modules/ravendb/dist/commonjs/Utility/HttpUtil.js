"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.HeadersBuilder = void 0;
exports.getRequiredEtagHeader = getRequiredEtagHeader;
exports.getEtagHeader = getEtagHeader;
exports.etagHeaderToChangeVector = etagHeaderToChangeVector;
exports.getBooleanHeader = getBooleanHeader;
exports.getHeaders = getHeaders;
exports.closeHttpResponse = closeHttpResponse;
const Constants_js_1 = require("../Constants.js");
const index_js_1 = require("../Exceptions/index.js");
function getRequiredEtagHeader(response) {
    let etagHeader = response.headers.get(Constants_js_1.HEADERS.ETAG);
    if (!etagHeader) {
        (0, index_js_1.throwError)("InvalidOperationException", "Response did't had an ETag header");
    }
    if (Array.isArray(etagHeader)) {
        etagHeader = etagHeader[0];
    }
    return etagHeaderToChangeVector(etagHeader);
}
function getEtagHeader(responseOrHeaders) {
    let etagHeaders;
    if ("headers" in responseOrHeaders) {
        etagHeaders = responseOrHeaders.headers.get(Constants_js_1.HEADERS.ETAG);
    }
    else if (Constants_js_1.HEADERS.ETAG in responseOrHeaders) {
        etagHeaders = responseOrHeaders[Constants_js_1.HEADERS.ETAG];
    }
    else {
        etagHeaders = null;
    }
    const singleHeader = Array.isArray(etagHeaders) ? etagHeaders[0] : (etagHeaders || null);
    return singleHeader ? etagHeaderToChangeVector(singleHeader) : null;
}
function etagHeaderToChangeVector(responseHeader) {
    if (!responseHeader) {
        (0, index_js_1.throwError)("InvalidOperationException", "Response did't had an ETag header");
    }
    if (responseHeader.startsWith(`"`)) {
        return responseHeader.substring(1, responseHeader.length - 1);
    }
    return responseHeader;
}
function getBooleanHeader(response, header) {
    const headers = response.headers;
    let headerVal = headers.get(header);
    if (headerVal && Array.isArray(headerVal)) {
        headerVal = (headerVal[0] || null);
    }
    return headerVal
        ? headerVal.toLowerCase() === "true"
        : null;
}
function getHeaders() {
    return HeadersBuilder.create();
}
function closeHttpResponse(response) {
    // node-fetch closes response for us - no action is required
}
class HeadersBuilder {
    _result = {};
    static create() {
        return new HeadersBuilder();
    }
    typeAppJson() {
        this._result["content-type"] = "application/json";
        return this;
    }
    with(name, val) {
        this._result[name] = val;
        return this;
    }
    build() {
        return this._result;
    }
}
exports.HeadersBuilder = HeadersBuilder;
//# sourceMappingURL=HttpUtil.js.map