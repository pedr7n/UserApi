{"version":3,"file":"TimeSeriesValuesHelper.js","sourceRoot":"","sources":["../../../../../src/Documents/Session/TimeSeries/TimeSeriesValuesHelper.ts"],"names":[],"mappings":"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","sourcesContent":["import { ClassConstructor } from \"../../../Types/index.js\";\r\nimport { throwError } from \"../../../Exceptions/index.js\";\r\nimport { TypeUtil } from \"../../../Utility/TypeUtil.js\";\r\nimport { TimeSeriesValue } from \"./TimeSeriesValue.js\";\r\n\r\ntype TimeSeriesFieldsMapping = { field: string; name: string }[];\r\n\r\n\r\nexport class TimeSeriesValuesHelper {\r\n\r\n    private static readonly _cache = new Map<ClassConstructor<any>, TimeSeriesFieldsMapping>();\r\n\r\n    public static getFieldsMapping(clazz: ClassConstructor<any>): TimeSeriesFieldsMapping {\r\n        if (TimeSeriesValuesHelper._cache.has(clazz)) {\r\n            return TimeSeriesValuesHelper._cache.get(clazz);\r\n        }\r\n\r\n        if (\"TIME_SERIES_VALUES\" in clazz) {\r\n            const values = clazz[\"TIME_SERIES_VALUES\"] as TimeSeriesValue<any>;\r\n            if (TypeUtil.isArray(values)) {\r\n                const mapping: TimeSeriesFieldsMapping = [];\r\n\r\n                for (const value of values) {\r\n                    let field: string;\r\n                    let name: string;\r\n                    if (TypeUtil.isString(value)) {\r\n                        field = value;\r\n                        name = value;\r\n                    } else if (TypeUtil.isObject(value) && value.field && value.name) {\r\n                        field = value.field;\r\n                        name = value.name;\r\n                    } else {\r\n                        throwError(\"InvalidOperationException\", \"Invalid field mapping. Expected string or { field: string, name: string } object. Got: \" + value);\r\n                    }\r\n\r\n                    const nameAlreadyUsed = mapping.some(x => x.field === field || x.name === name);\r\n                    if (nameAlreadyUsed) {\r\n                        throwError(\"InvalidOperationException\", \"All fields and names must be unique.\");\r\n                    }\r\n\r\n                    mapping.push({\r\n                        field, name\r\n                    });\r\n                }\r\n\r\n                TimeSeriesValuesHelper._cache.set(clazz, mapping);\r\n                return mapping;\r\n            } else {\r\n                throwError(\"InvalidOperationException\", \"The mapping of \" + clazz + \" is invalid.\");\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    public static getValues<T extends object>(clazz: ClassConstructor<T>, obj: T): number[] {\r\n        const mapping = TimeSeriesValuesHelper.getFieldsMapping(clazz)\r\n        if (!mapping) {\r\n            return null;\r\n        }\r\n\r\n        return mapping.map(m => obj[m.field]);\r\n    }\r\n\r\n    public static setFields<T extends object>(clazz: ClassConstructor<T>, values: number[], asRollup: boolean = false): T {\r\n        if (!values) {\r\n            return null;\r\n        }\r\n\r\n        const mapping = TimeSeriesValuesHelper.getFieldsMapping(clazz);\r\n        if (!mapping) {\r\n            return null;\r\n        }\r\n\r\n        const obj = new clazz();\r\n\r\n        for (let i = 0; i < mapping.length; i++) {\r\n            let index = i;\r\n            const item = mapping[i];\r\n\r\n            let value = Number.NaN;\r\n            if (index < values.length) {\r\n                if (asRollup) {\r\n                    index *= 6;\r\n                }\r\n\r\n                value = values[index];\r\n            }\r\n\r\n            obj[item.field] = value;\r\n        }\r\n\r\n        return obj;\r\n    }\r\n}\r\n"]}