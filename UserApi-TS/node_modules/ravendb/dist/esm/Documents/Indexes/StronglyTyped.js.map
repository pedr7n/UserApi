{"version":3,"file":"StronglyTyped.js","sourceRoot":"","sources":["../../../../src/Documents/Indexes/StronglyTyped.ts"],"names":[],"mappings":"AAqCA,MAAM,OAAO,YAAY;IACrB,IAAI,CAAmD;IACvD,OAAO,CAA8B;IACrC,WAAW,CAAoC;IAC/C,EAAE,CAA4B;IAC9B,kBAAkB,CAAoD;IACtE,WAAW,CAAmE;IAC9E,cAAc,CAAsD;IACpE,cAAc,CAA+D;IAC7E,eAAe,CAAyC;IACxD,UAAU,CAAkB;CAC/B;AAOD,MAAM,OAAO,oBAAoB;IAGtB,OAAO,CAAO,QAAsC;QACvD,OAAO,IAAI,qBAAqB,CAAkB,QAAQ,CAAC,CAAC;IAChE,CAAC;CACJ;AAED,MAAM,OAAO,qBAAqB;IAEtB,MAAM,CAA+B;IAE7C,YAAY,QAAsC;QAC9C,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC;IAC3B,CAAC;IAEM,SAAS,CAAC,OAAiE;QAC9E,OAAO,IAAI,0BAA0B,CAAY,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;IAC3E,CAAC;CACJ;AAED,MAAM,OAAO,0BAA0B;IAC3B,QAAQ,CAA8B;IACtC,UAAU,CAAoD;IAEtE,YAAmB,OAAoC,EAAE,SAA4D;QACjH,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;IAChC,CAAC;IAEM,MAAM;QACT,OAAO,WAAW,IAAI,CAAC,QAAQ,eAAe,IAAI,CAAC,UAAU,GAAG,CAAC;IACrE,CAAC;CACJ","sourcesContent":["import { FieldIndexing, FieldStorage, FieldTermVector } from \"./Enums.js\";\r\nimport { MetadataObject } from \"../Session/MetadataObject.js\";\r\nimport { AttachmentName, IAttachmentObject } from \"../Attachments/index.js\";\r\nimport { CapitalizeType } from \"../../Types/index.js\";\r\nimport { FieldVectorOptions } from \"../Queries/VectorSearch/VectorSearchOptions.js\";\r\n\r\nexport type IndexingMapDefinition<TInput, TOutput> = (document: TInput) => TOutput | TOutput[];\r\n\r\nexport type IndexingReduceDefinition<TItem> = (result: IndexingGroupResults<TItem>) => IndexingMapReduceFormatter<TItem>;\r\n\r\ntype KeySelector<TDocument, TKey> = (document: TDocument) => TKey;\r\n\r\nexport interface CreateFieldOptions {\r\n    storage?: boolean;\r\n    indexing?: FieldIndexing;\r\n    termVector?: FieldTermVector;\r\n    vector?: FieldVectorOptions;\r\n}\r\n\r\nexport interface IndexingMapUtils {\r\n    load<T = any>(documentId: string, collection: string): T;\r\n    cmpxchg<T = any>(key: string): T;\r\n    getMetadata(document: any): MetadataObject;\r\n    id(document: any): string;\r\n    createSpatialField(wkt: string): SpatialField;\r\n    createSpatialField(lat: number, lng: number): SpatialField;\r\n    createField(name: string, value: any, options: CreateFieldOptions): void;\r\n    attachmentsFor(document: any): CapitalizeType<AttachmentName>[];\r\n    loadAttachment(document: any, attachmentName: string): IAttachmentObject;\r\n    loadAttachments(document: any): IAttachmentObject[];\r\n    noTracking: NoTrackingUtils;\r\n}\r\n\r\nexport interface NoTrackingUtils {\r\n    load<T = any>(documentId: string, collection: string): T;\r\n}\r\n\r\nexport class StubMapUtils<T> implements IndexingMapUtils {\r\n    load: <T>(documentId: string, collection: string) => T;\r\n    cmpxchg: <T = any>(key: string) => T;\r\n    getMetadata: (document: any) => MetadataObject;\r\n    id: (document: any) => string;\r\n    createSpatialField: (wktOrLat: string | number, lng?: number) => void;\r\n    createField: (name: string, value: any, options?: CreateFieldOptions) => void;\r\n    attachmentsFor: (document: any) => CapitalizeType<AttachmentName>[];\r\n    loadAttachment: (document: any, attachmentName: string) => IAttachmentObject;\r\n    loadAttachments: (document: any) => IAttachmentObject[];\r\n    noTracking: NoTrackingUtils;\r\n}\r\n\r\ninterface Group<TDocument, TKey> {\r\n    key: TKey;\r\n    values: TDocument[];\r\n}\r\n\r\nexport class IndexingGroupResults<TDocument> {\r\n\r\n    public groupBy<TKey>(selector: KeySelector<TDocument, TKey>): TKey extends void ? never : IndexingReduceResults<TDocument, TKey>;\r\n    public groupBy<TKey>(selector: KeySelector<TDocument, TKey>): IndexingReduceResults<TDocument, TKey> {\r\n        return new IndexingReduceResults<TDocument, TKey>(selector);\r\n    }\r\n}\r\n\r\nexport class IndexingReduceResults<TDocument, TKey> {\r\n\r\n    private _group: KeySelector<TDocument, TKey>;\r\n\r\n    constructor(selector: KeySelector<TDocument, TKey>) {\r\n        this._group = selector;\r\n    }\r\n\r\n    public aggregate(reducer: IndexingMapDefinition<Group<TDocument, TKey>, TDocument>): IndexingMapReduceFormatter<TDocument> {\r\n        return new IndexingMapReduceFormatter<TDocument>(this._group, reducer);\r\n    }\r\n}\r\n\r\nexport class IndexingMapReduceFormatter<TDocument> {\r\n    private _groupBy: KeySelector<TDocument, any>;\r\n    private _aggregate: IndexingMapDefinition<Group<TDocument, any>, any>;\r\n\r\n    public constructor(groupBy: KeySelector<TDocument, any>, aggregate: IndexingMapDefinition<Group<TDocument, any>, any>) {\r\n        this._groupBy = groupBy;\r\n        this._aggregate = aggregate;\r\n    }\r\n\r\n    public format(): string {\r\n        return `groupBy(${this._groupBy}).aggregate(${this._aggregate})`;\r\n    }\r\n}\r\n\r\nexport type CreatedFieldOptions = {\r\n    storage?: FieldStorage | boolean;\r\n    indexing?: FieldIndexing;\r\n    termVector?: FieldTermVector;\r\n}\r\n\r\nexport type CreatedField = {\r\n    $value: any;\r\n    $name: string;\r\n    $options: CreatedFieldOptions;\r\n}\r\n\r\nexport type SpatialField = void;\r\n"]}