{"version":3,"file":"BackupUtils.js","sourceRoot":"","sources":["../../../../src/Documents/Smuggler/BackupUtils.ts"],"names":[],"mappings":"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","sourcesContent":["import { CONSTANTS } from \"../../Constants.js\";\r\nimport { StringUtil } from \"../../Utility/StringUtil.js\";\r\nimport { basename, extname, resolve } from \"node:path\";\r\n\r\nexport class BackupUtils {\r\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n    private constructor() {\r\n        // empty\r\n    }\r\n\r\n    private static readonly LEGACY_INCREMENTAL_BACKUP_EXTENSION = \".ravendb-incremental-dump\";\r\n    private static readonly LEGACY_FULL_BACKUP_EXTENSION = \".ravendb-full-dump\";\r\n\r\n    public static BACKUP_FILE_SUFFIXES = [\r\n        BackupUtils.LEGACY_INCREMENTAL_BACKUP_EXTENSION,\r\n        BackupUtils.LEGACY_FULL_BACKUP_EXTENSION,\r\n        CONSTANTS.Documents.PeriodicBackup.INCREMENTAL_BACKUP_EXTENSION,\r\n        CONSTANTS.Documents.PeriodicBackup.ENCRYPTED_INCREMENTAL_BACKUP_EXTENSION,\r\n        CONSTANTS.Documents.PeriodicBackup.FULL_BACKUP_EXTENSION,\r\n        CONSTANTS.Documents.PeriodicBackup.ENCRYPTED_FULL_BACKUP_EXTENSION\r\n    ];\r\n\r\n    public static isFullBackupOrSnapshot(extension: string): boolean {\r\n        return BackupUtils.isSnapshot(extension) || BackupUtils.isFullBackup(extension);\r\n    }\r\n\r\n    public static isFullBackup(extension: string): boolean {\r\n        return StringUtil.equalsIgnoreCase(CONSTANTS.Documents.PeriodicBackup.FULL_BACKUP_EXTENSION, extension)\r\n            || StringUtil.equalsIgnoreCase(CONSTANTS.Documents.PeriodicBackup.ENCRYPTED_FULL_BACKUP_EXTENSION, extension);\r\n    }\r\n\r\n    public static isSnapshot(extension: string) {\r\n        return StringUtil.equalsIgnoreCase(CONSTANTS.Documents.PeriodicBackup.SNAPSHOT_EXTENSION, extension)\r\n            || StringUtil.equalsIgnoreCase(CONSTANTS.Documents.PeriodicBackup.ENCRYPTED_FULL_BACKUP_EXTENSION, extension);\r\n    }\r\n\r\n    public static isIncrementalBackupFile(extension: string): boolean {\r\n        return StringUtil.equalsIgnoreCase(CONSTANTS.Documents.PeriodicBackup.INCREMENTAL_BACKUP_EXTENSION, extension)\r\n            || StringUtil.equalsIgnoreCase(CONSTANTS.Documents.PeriodicBackup.ENCRYPTED_INCREMENTAL_BACKUP_EXTENSION, extension)\r\n            || StringUtil.equalsIgnoreCase(BackupUtils.LEGACY_INCREMENTAL_BACKUP_EXTENSION, extension);\r\n    }\r\n\r\n    public static comparator(o1: string, o2: string, mtimeProvider: (file: string) => number) {\r\n        const baseName1 = basename(o1, extname(o1));\r\n        const baseName2 = basename(o2, extname(o2));\r\n\r\n        if (baseName1 !== baseName2) {\r\n            return baseName1.localeCompare(baseName2);\r\n        }\r\n\r\n        const extension1 = extname(o1);\r\n        const extension2 = extname(o2);\r\n\r\n        if (extension1 !== extension2) {\r\n            return periodicBackupFileExtensionComparator(o1, o2);\r\n        }\r\n\r\n        const lastModified1 = mtimeProvider(o1);\r\n        const lastModified2 = mtimeProvider(o2);\r\n\r\n        return lastModified1 - lastModified2;\r\n    }\r\n\r\n}\r\n\r\nexport function periodicBackupFileExtensionComparator(o1: string, o2: string) {\r\n    if (resolve(o1) === resolve(o2)) {\r\n        return 0;\r\n    }\r\n\r\n    if (StringUtil.equalsIgnoreCase(extname(o1), \".\" + CONSTANTS.Documents.PeriodicBackup.SNAPSHOT_EXTENSION)) {\r\n        return -1;\r\n    }\r\n\r\n    if (StringUtil.equalsIgnoreCase(extname(o1), \".\" + CONSTANTS.Documents.PeriodicBackup.FULL_BACKUP_EXTENSION)) {\r\n        return -1;\r\n    }\r\n\r\n    return 1;\r\n}\r\n"]}