{"version":3,"file":"TimeSeriesOperation.js","sourceRoot":"","sources":["../../../../../src/Documents/Operations/TimeSeries/TimeSeriesOperation.ts"],"names":[],"mappings":"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","sourcesContent":["import { DateUtil } from \"../../../Utility/DateUtil.js\";\r\nimport { DocumentConventions } from \"../../Conventions/DocumentConventions.js\";\r\n\r\nexport class TimeSeriesOperation {\r\n    private _appends: Map<number, AppendOperation>; // using map in node - for performance\r\n    private _deletes: DeleteOperation[];\r\n    private _increments: Map<number, IncrementOperation>;\r\n    name: string;\r\n\r\n    public constructor()\r\n    public constructor(name: string)\r\n    public constructor(name?: string) {\r\n        this.name = name;\r\n    }\r\n\r\n    public serialize(conventions: DocumentConventions): object {\r\n        const sortedAppends = this._appends ?\r\n            Array.from(this._appends.values())\r\n                .sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime())\r\n                .map(x => x.serialize(conventions))\r\n            : null;\r\n\r\n        return {\r\n            Name: this.name,\r\n            Appends: sortedAppends,\r\n            Deletes: this._deletes ? this._deletes.map(x => x.serialize(conventions)) : null,\r\n            Increments: this._increments ? Array.from(this._increments.values()).map(x => x.serialize(conventions)) : null\r\n        }\r\n    }\r\n\r\n    public increment(incrementOperation: IncrementOperation) {\r\n        if (!this._increments) {\r\n            this._increments = new Map<number, IncrementOperation>();\r\n        }\r\n\r\n        const time = incrementOperation.timestamp.getTime();\r\n        if (this._increments.has(time)) {\r\n            this._increments.delete(time);\r\n        }\r\n\r\n        this._increments.set(time, incrementOperation);\r\n    }\r\n\r\n    public append(appendOperation: AppendOperation): void {\r\n        if (!this._appends) {\r\n            this._appends = new Map<number, AppendOperation>();\r\n        }\r\n\r\n        const time = appendOperation.timestamp.getTime();\r\n        if (this._appends.has(time)) {\r\n            this._appends.delete(time);\r\n        }\r\n\r\n        this._appends.set(time, appendOperation);\r\n    }\r\n\r\n    public delete(deleteOperation: DeleteOperation) {\r\n        if (!this._deletes) {\r\n            this._deletes = [];\r\n        }\r\n\r\n        this._deletes.push(deleteOperation);\r\n    }\r\n\r\n}\r\n\r\nexport class AppendOperation {\r\n    public timestamp: Date;\r\n    public values: number[];\r\n    public tag: string;\r\n\r\n    public constructor(timestamp: Date, values: number[]);\r\n    public constructor(timestamp: Date, values: number[], tag: string);\r\n    public constructor(timestamp: Date, values: number[], tag?: string) {\r\n        this.timestamp = timestamp;\r\n        this.values = values;\r\n        this.tag = tag;\r\n    }\r\n\r\n    public serialize(conventions: DocumentConventions): object {\r\n        return {\r\n            Timestamp: DateUtil.utc.stringify(this.timestamp),\r\n            Values: this.values,\r\n            Tag: this.tag || undefined\r\n        };\r\n    }\r\n}\r\n\r\nexport class DeleteOperation {\r\n    public from: Date;\r\n    public to: Date;\r\n\r\n    public constructor();\r\n    public constructor(from: Date, to: Date);\r\n    public constructor(from?: Date, to?: Date) {\r\n        this.from = from;\r\n        this.to = to;\r\n    }\r\n\r\n    public serialize(conventions: DocumentConventions): object {\r\n        return {\r\n            From: this.from ? DateUtil.utc.stringify(this.from) : null,\r\n            To : this.to ? DateUtil.utc.stringify(this.to) : null\r\n        };\r\n    }\r\n}\r\n\r\nexport class IncrementOperation {\r\n    public timestamp: Date;\r\n    public values: number[];\r\n\r\n    public serialize(conventions: DocumentConventions): object {\r\n        return {\r\n            Timestamp: this.timestamp ? DateUtil.utc.stringify(this.timestamp) : null,\r\n            Values: this.values\r\n        }\r\n    }\r\n}\r\n"]}